# Billing Generator

## Requirements
[Docker](https://www.docker.com/)

## How to run

1. Create the  `docker-compose.yml`
Copy the text below and save it as `docker-compose.yml`

```yml
version: '3.8'
services:
  db:
    image: mongo
    ports:
      - 27017:27017
    volumes:
      - db:/data/db
  server:
    image: nmacawile/billing-dev-server
    ports:
      - 3000:3000
    # environment:
    #  - RAILS_MASTER_KEY=redacted
    volumes:
      - server_data:/app
  client:
    image: nmacawile/billing-dev-client
    ports:
      - 4200:4200
    volumes:
      - client_data:/app
volumes: 
  server_data:
  client_data:
  db:

```

2. Create and run the containers
Run this command in the same directory as the `docker-compose.yml`:

```sh
docker-compose run
```

3. Find a reference to the billing-dev-server's container 
Run this to view the list of running containers

```sh
docker ps
```
Find and copy the ID or the name of the container for billing-dev-server

4. Access the container's shell
Run this command:
```sh
docker exec -it <container_id or container_name> /bin/sh
```

5. Generate a master key
While inside the container's shell, run this command to generate `config/master.key`
```sh
rails credentials:edit
```
`config/master.key` goes together with `config/credentials.yml.enc` so a new one will also be generated by running the command above.

6. Seed the database
Still inside the container's shell, run this command to seed the database:

```sh
rails db:seed
```

7. Launch the app's client
On the browser, go to `localhost:4200/#/login`

8. Log in 
Use this account (Registration is temporarily disabled):
  - email: `user@email.com`
  - password: `111111`

## Rebuilding the images
From the root directory of the project, run:

```
docker build -t billing-dev-server -f Dockerfile-dev .
docker build -t billing-dev-client -f client/Dockerfile client
```
